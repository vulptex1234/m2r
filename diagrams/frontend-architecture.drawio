<mxfile host="app.diagrams.net" agent="Claude Code" version="24.0.0">
  <diagram name="Frontend Architecture" id="frontend-arch">
    <mxGraphModel dx="1422" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1400">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="Frontend Architecture (HTML/CSS/JavaScript)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="20" width="800" height="40" as="geometry"/>
        </mxCell>

        <!-- UI Components Section -->
        <mxCell id="ui-container" value="&lt;b&gt;public/index.html - UIコンポーネント&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=16;align=center;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="80" y="80" width="600" height="660" as="geometry"/>
        </mxCell>

        <!-- Header -->
        <mxCell id="ui-header" value="&lt;b&gt;Header&lt;/b&gt;&lt;br&gt;&lt;br&gt;• タイトル: ESP32 IoT Dashboard&lt;br&gt;• Connection status indicator&lt;br&gt;• Processing status&lt;br&gt;• Refresh button" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="120" width="260" height="110" as="geometry"/>
        </mxCell>

        <!-- Metrics Cards -->
        <mxCell id="ui-metrics" value="&lt;b&gt;Metrics Cards (4個)&lt;/b&gt;&lt;br&gt;&lt;br&gt;• Current Temperature (実測値)&lt;br&gt;  温度変化トレンド表示&lt;br&gt;&lt;br&gt;• Forecast Temperature (予測値)&lt;br&gt;  取得時刻表示&lt;br&gt;&lt;br&gt;• System Error (sErr)&lt;br&gt;  誤差スコア 0-1&lt;br&gt;&lt;br&gt;• Current Rate (レート)&lt;br&gt;  LOW/MEDIUM/HIGH + 理由" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="380" y="120" width="280" height="220" as="geometry"/>
        </mxCell>

        <!-- Charts Section -->
        <mxCell id="ui-charts" value="&lt;b&gt;Charts Section (Chart.js)&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;1. 実測温度グラフ&lt;/b&gt;&lt;br&gt;   • Timeframe: 1h/6h/24h/72h/120h&lt;br&gt;   • 実測値 vs 予測値&lt;br&gt;&lt;br&gt;&lt;b&gt;2. 過去天気グラフ&lt;/b&gt;&lt;br&gt;   • OpenWeatherMap履歴データ&lt;br&gt;   • 自動更新 (30分以上古い場合)&lt;br&gt;&lt;br&gt;&lt;b&gt;3. 予測履歴グラフ&lt;/b&gt;&lt;br&gt;   • Display count: 5/10/20/all&lt;br&gt;   • Timeframe: 24h/48h/72h&lt;br&gt;   • 複数スナップショット重ね表示" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="250" width="260" height="240" as="geometry"/>
        </mxCell>

        <!-- Data Table -->
        <mxCell id="ui-table" value="&lt;b&gt;Data Table&lt;/b&gt;&lt;br&gt;&lt;br&gt;• Recent measurements (最新50件)&lt;br&gt;• Columns:&lt;br&gt;  - Timestamp&lt;br&gt;  - Device ID&lt;br&gt;  - Temperature&lt;br&gt;  - Forecast&lt;br&gt;  - Error&lt;br&gt;  - Rate&lt;br&gt;• Export CSV button" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="510" width="260" height="150" as="geometry"/>
        </mxCell>

        <!-- Control Panel -->
        <mxCell id="ui-control" value="&lt;b&gt;Control Panel&lt;/b&gt;&lt;br&gt;&lt;br&gt;• Refresh forecast button&lt;br&gt;• Data cleanup controls&lt;br&gt;• Delete buttons:&lt;br&gt;  - Delete measurements&lt;br&gt;  - Delete historical&lt;br&gt;  - Delete all data&lt;br&gt;  (確認ダイアログ付き)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="380" y="360" width="280" height="150" as="geometry"/>
        </mxCell>

        <!-- Alert Container -->
        <mxCell id="ui-alert" value="&lt;b&gt;Alert Container&lt;/b&gt;&lt;br&gt;&lt;br&gt;• Success/Error/Warning messages&lt;br&gt;• Auto-dismiss (3秒)&lt;br&gt;• Toast-style notifications" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="380" y="530" width="280" height="80" as="geometry"/>
        </mxCell>

        <!-- Styling Note -->
        <mxCell id="ui-styling" value="&lt;b&gt;Styling: Tailwind CSS&lt;/b&gt;&lt;br&gt;&lt;br&gt;• Utility-first CSS framework&lt;br&gt;• Dark mode support&lt;br&gt;• Responsive design&lt;br&gt;• Color scheme:&lt;br&gt;  - Primary: Blue&lt;br&gt;  - Success: Green&lt;br&gt;  - Warning: Yellow&lt;br&gt;  - Error: Red" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="680" width="560" height="50" as="geometry"/>
        </mxCell>

        <!-- JavaScript Modules Section -->
        <mxCell id="js-container" value="&lt;b&gt;public/js/ - JavaScriptモジュール (ES6)&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=16;align=center;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="720" y="80" width="600" height="660" as="geometry"/>
        </mxCell>

        <!-- dashboard.js -->
        <mxCell id="js-dashboard" value="&lt;b&gt;dashboard.js (メインコントローラ)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;align=center;verticalAlign=top;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="120" width="560" height="160" as="geometry"/>
        </mxCell>
        <mxCell id="js-dashboard-content" value="&lt;b&gt;DashboardController class:&lt;/b&gt;&lt;br&gt;• initialize() - 初期化&lt;br&gt;• loadInitialData() - データ読み込み&lt;br&gt;• updateMeasurementsChart() - 実測グラフ更新&lt;br&gt;• updateHistoricalChart() - 過去天気グラフ更新&lt;br&gt;• updateForecastHistoryChart() - 予測履歴グラフ更新&lt;br&gt;• startPeriodicUpdates() - 30秒ごと自動更新&lt;br&gt;• switchChartTimeframe() - 時間軸切り替え&lt;br&gt;• showAlert() - アラート表示" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="750" y="150" width="540" height="120" as="geometry"/>
        </mxCell>

        <!-- backend-service.js -->
        <mxCell id="js-backend" value="&lt;b&gt;backend-service.js (API通信)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;align=center;verticalAlign=top;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="300" width="560" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="js-backend-content" value="&lt;b&gt;BackendService class:&lt;/b&gt;&lt;br&gt;• getProcessedMeasurements() - 処理済みデータ取得&lt;br&gt;• getHistoricalWeather() - 過去天気データ取得&lt;br&gt;• getForecastSnapshots() - 予測履歴取得&lt;br&gt;• getScoreLogs() - スコアログ取得&lt;br&gt;• deleteAllData() - 全削除&lt;br&gt;• Error handling with retry logic" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="750" y="330" width="540" height="80" as="geometry"/>
        </mxCell>

        <!-- weather-service.js -->
        <mxCell id="js-weather" value="&lt;b&gt;weather-service.js&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;align=center;verticalAlign=top;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="440" width="560" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="js-weather-content" value="&lt;b&gt;WeatherService class:&lt;/b&gt;&lt;br&gt;• getForecastFromAPI() - OpenWeatherMap API呼び出し&lt;br&gt;• cacheForecastSnapshot() - 無効化済み (Cron Jobが担当)&lt;br&gt;• processForecastData() - 予測データ処理" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="750" y="470" width="540" height="50" as="geometry"/>
        </mxCell>

        <!-- analytics-engine.js -->
        <mxCell id="js-analytics" value="&lt;b&gt;analytics-engine.js&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;align=center;verticalAlign=top;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="550" width="270" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="js-analytics-content" value="&lt;b&gt;テストデータ生成用:&lt;/b&gt;&lt;br&gt;• RateDecisionEngine&lt;br&gt;• DiscrepancyAnalyzer&lt;br&gt;(バックエンドと同一ロジック)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="750" y="580" width="250" height="40" as="geometry"/>
        </mxCell>

        <!-- realtime-processor.js -->
        <mxCell id="js-realtime" value="&lt;b&gt;realtime-processor.js&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=12;align=center;verticalAlign=top;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1030" y="550" width="270" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="js-realtime-content" value="&lt;b&gt;テストデータ処理:&lt;/b&gt;&lt;br&gt;• processRawMeasurement()&lt;br&gt;• saveForecastSnapshot()&lt;br&gt;  (無効化済み)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1040" y="580" width="250" height="40" as="geometry"/>
        </mxCell>

        <!-- export-manager.js -->
        <mxCell id="js-export" value="&lt;b&gt;export-manager.js&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;align=center;verticalAlign=top;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="740" y="650" width="270" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="js-export-content" value="&lt;b&gt;ExportManager class:&lt;/b&gt;&lt;br&gt;• exportToCSV()&lt;br&gt;• Data download functionality" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="750" y="680" width="250" height="40" as="geometry"/>
        </mxCell>

        <!-- app-config.js -->
        <mxCell id="js-config" value="&lt;b&gt;app-config.js&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=12;align=center;verticalAlign=top;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="1030" y="650" width="270" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="js-config-content" value="&lt;b&gt;Configuration:&lt;/b&gt;&lt;br&gt;• API endpoints&lt;br&gt;• Weather API config&lt;br&gt;• Control config (alpha, thresholds)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="1040" y="680" width="250" height="40" as="geometry"/>
        </mxCell>

        <!-- Libraries Section -->
        <mxCell id="lib-container" value="&lt;b&gt;外部ライブラリ&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontSize=16;align=center;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="80" y="780" width="600" height="180" as="geometry"/>
        </mxCell>

        <mxCell id="lib-chartjs" value="&lt;b&gt;Chart.js 4.x&lt;/b&gt;&lt;br&gt;&lt;br&gt;• グラフ描画ライブラリ&lt;br&gt;• Time-series support&lt;br&gt;• Responsive charts&lt;br&gt;• 3つのチャート:&lt;br&gt;  - measurementsChart&lt;br&gt;  - historicalChart&lt;br&gt;  - forecastHistoryChart" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="100" y="820" width="260" height="130" as="geometry"/>
        </mxCell>

        <mxCell id="lib-tailwind" value="&lt;b&gt;Tailwind CSS&lt;/b&gt;&lt;br&gt;&lt;br&gt;• Utility-first CSS&lt;br&gt;• Dark mode&lt;br&gt;• Responsive design" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="380" y="820" width="130" height="80" as="geometry"/>
        </mxCell>

        <mxCell id="lib-datefns" value="&lt;b&gt;date-fns&lt;/b&gt;&lt;br&gt;&lt;br&gt;• 日時処理&lt;br&gt;• フォーマット&lt;br&gt;• タイムゾーン" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=11;align=left;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="530" y="820" width="130" height="80" as="geometry"/>
        </mxCell>

        <!-- Data Flow -->
        <mxCell id="flow-container" value="&lt;b&gt;データフロー&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=16;align=center;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="720" y="780" width="600" height="180" as="geometry"/>
        </mxCell>

        <mxCell id="flow-content" value="&lt;b&gt;1. 初期ロード:&lt;/b&gt;&lt;br&gt;   dashboard.js → loadInitialData()&lt;br&gt;   → backend-service.js → Backend API&lt;br&gt;   → Chart.js でグラフ描画&lt;br&gt;&lt;br&gt;&lt;b&gt;2. 定期更新:&lt;/b&gt;&lt;br&gt;   30秒ごと → loadInitialData()&lt;br&gt;   → チャート更新&lt;br&gt;&lt;br&gt;&lt;b&gt;3. ユーザーインタラクション:&lt;/b&gt;&lt;br&gt;   ボタンクリック → イベントハンドラ&lt;br&gt;   → API呼び出し → UI更新&lt;br&gt;   → アラート表示" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="740" y="820" width="560" height="130" as="geometry"/>
        </mxCell>

        <!-- Deployment -->
        <mxCell id="deploy-section" value="&lt;b&gt;デプロイ (Render Static Site)&lt;/b&gt;&lt;br&gt;&lt;br&gt;• Build command: (不要 - 静的ファイル)&lt;br&gt;• Publish directory: public/&lt;br&gt;• Auto-deploy: main ブランチ push 時&lt;br&gt;• URL: https://m2r.onrender.com&lt;br&gt;• Backend API: 同一ドメイン /api/*" style="text;html=1;strokeColor=#d6b656;fillColor=#fff2cc;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="80" y="1000" width="1240" height="100" as="geometry"/>
        </mxCell>

        <!-- Chart Configuration -->
        <mxCell id="chart-config" value="&lt;b&gt;Chart.js 設定&lt;/b&gt;&lt;br&gt;&lt;br&gt;&lt;b&gt;実測温度グラフ:&lt;/b&gt;&lt;br&gt;• X軸: time (1h/6h/24h/72h/120h)&lt;br&gt;• Y軸: 温度 (°C)&lt;br&gt;• Dataset 1: 実測値 (青)&lt;br&gt;• Dataset 2: 予測値 (オレンジ)&lt;br&gt;&lt;br&gt;&lt;b&gt;過去天気グラフ:&lt;/b&gt;&lt;br&gt;• X軸: time (過去24時間)&lt;br&gt;• Y軸: 温度 (°C)&lt;br&gt;• Dataset: OpenWeatherMap (緑)&lt;br&gt;&lt;br&gt;&lt;b&gt;予測履歴グラフ:&lt;/b&gt;&lt;br&gt;• X軸: time (3時間間隔)&lt;br&gt;• Y軸: 温度 (°C)&lt;br&gt;• Multiple datasets: 各スナップショット&lt;br&gt;• autoSkip: false (すべてのラベル表示)&lt;br&gt;• maxRotation: 45° (ラベル回転)" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;align=left;verticalAlign=top;whiteSpace=wrap;rounded=1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="80" y="1140" width="1240" height="220" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
